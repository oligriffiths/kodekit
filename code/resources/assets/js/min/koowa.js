/**
 * Nooku Framework - http://nooku.org/framework
 *
 * @copyright	Copyright (C) 2007 - 2014 Johan Janssens and Timble CVBA. (http://www.timble.net)
 * @license		GNU GPLv3 <http://www.gnu.org/licenses/gpl.html>
 * @link		https://github.com/nooku/nooku-framework for the canonical source repository
 */
if(!Koowa)var Koowa={};Function.prototype.bind||(Function.prototype.bind=function(a){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var b=Array.prototype.slice.call(arguments,1),c=this,d=function(){},e=function(){return c.apply(this instanceof d&&a?this:a,b.concat(Array.prototype.slice.call(arguments)))};return d.prototype=this.prototype,e.prototype=new d,e}),function(a){/*!
 * klass: a classical JS OOP fa√ßade
 * https://github.com/ded/klass
 * License MIT (c) Dustin Diaz & Jacob Thornton 2012
 */
var b=function(){function a(a){return e.call(b(a)?a:function(){},a,1)}function b(a){return typeof a===h}function c(a,b,c){return function(){var d=this.supr;this.supr=c[j][a];var e={}.fabricatedUndefined,f=e;try{f=b.apply(this,arguments)}finally{this.supr=d}return f}}function d(a,d,e){for(var f in d)d.hasOwnProperty(f)&&(a[f]=b(d[f])&&b(e[j][f])&&i.test(d[f])?c(f,d[f],e):d[f])}function e(a,c){function e(){}function f(){this.initialize?this.initialize.apply(this,arguments):(c||i&&g.apply(this,arguments),k.apply(this,arguments))}e[j]=this[j];var g=this,h=new e,i=b(a),k=i?a:this,l=i?{}:a;return f.methods=function(a){return d(h,a,g),f[j]=h,this},f.methods.call(f,l).prototype.constructor=f,f.extend=arguments.callee,f[j].implement=f.statics=function(a,b){return a="string"==typeof a?function(){var c={};return c[a]=b,c}():a,d(this,a,g),this},f}var f=this,g=f.klass,h="function",i=/xyz/.test(function(){xyz})?/\bsupr\b/:/.*/,j="prototype";return a.noConflict=function(){return f.klass=g,this},a}();a(function(){a(".submittable").on("click.koowa",function(b){b.preventDefault(),new Koowa.Form(a(b.target).data("config")).submit()}),a(".-koowa-grid").each(function(){new Koowa.Controller.Grid({form:this})}),a(".-koowa-form").each(function(){new Koowa.Controller.Form({form:this})})}),Koowa.Class=b({options:{},getOptions:function(){return{}},initialize:function(){this.setOptions(this.getOptions())},setOptions:function(b){return"object"==typeof b&&(this.options=a.extend(!0,{},this.options,b)),this}}),Koowa.Translator||(Koowa.Translator=Koowa.Class.extend({translations:{},translate:function(a,b){if("undefined"!=typeof this.translations[a.toLowerCase()]&&(a=this.translations[a.toLowerCase()]),"object"==typeof b&&null!==b)for(var c in b)if(b.hasOwnProperty(c)){var d="{"+c+"}".replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&");a=a.replace(new RegExp(d,"g"),b[c])}return a},loadTranslations:function(a){for(var b in a)a.hasOwnProperty(b)&&(this.translations[b.toLowerCase()]=a[b]);return this}}),Koowa.translator=new Koowa.Translator,Koowa.translate=Koowa.translator.translate.bind(Koowa.translator)),Koowa.Form=Koowa.Class.extend({initialize:function(b){this.config=b,this.config.element?this.form=a(document[this.config.element]):(this.form=a("<form/>",{name:"dynamicform",method:this.config.method||"POST",action:this.config.url}),a(document.body).append(this.form))},addField:function(b,c){var d=a("<input/>",{name:b,value:c,type:"hidden"});return d.appendTo(this.form),this},submit:function(){var b=this;this.config.params&&a.each(this.config.params,function(a,c){b.addField(a,c)}),this.form.submit()}}),Koowa.Grid=Koowa.Class.extend({initialize:function(b){var c=this;this.element=a(b),this.form=this.element.is("form")?this.element:this.element.closest("form"),this.toggles=this.element.find(".-koowa-grid-checkall"),this.checkboxes=this.element.find(".-koowa-grid-checkbox").filter(function(b,c){return!a(c).prop("disabled")}),this.checkboxes.length||this.toggles.prop("disabled",!0),this.toggles.on("change.koowa",function(b,d){d||c.checkAll(a(this).prop("checked"))}),this.checkboxes.on("change.koowa",function(a,b){b||c.setCheckAll()})},checkAll:function(b){var c=this.checkboxes.filter(function(c,d){return a(d).prop("checked")!==b});this.checkboxes.prop("checked",b),c.trigger("change",!0)},uncheckAll:function(){this.checkAll(!1)},setCheckAll:function(){var b=this.checkboxes.filter(function(b,c){return a(c).prop("checked")!==!1}).length;this.toggles.prop("checked",this.checkboxes.length===b),this.toggles.trigger("change",!0)}}),Koowa.Grid.getAllSelected=function(b){return a(".-koowa-grid-checkbox:checked",b)},Koowa.Grid.getIdQuery=function(a){return decodeURIComponent(this.getAllSelected(a).serialize())},Koowa.Controller=Koowa.Class.extend({form:null,toolbar:null,buttons:null,token_name:null,token_value:null,getOptions:function(){return a.extend(this.supr(),{toolbar:".k-toolbar",url:window.location.href})},initialize:function(b){var c=this;this.supr(),this.setOptions(b),this.form=a(this.options.form),this.setOptions(this.form.data()),this.form.prop("action")&&(this.options.url=this.form.attr("action")),this.toolbar=a(this.options.toolbar),this.form.data("controller",this),this.on("execute",function(){return c.execute.apply(c,arguments)}),this.token_name=this.form.data("token-name"),this.token_value=this.form.data("token-value"),this.toolbar&&this.setToolbar()},setToolbar:function(){var b=this;this.buttons=this.toolbar.find(".toolbar[data-action]"),this.buttons.each(function(){var c=a(this),d={},e=c.data(),f=e.data;e.eventAdded||("object"!=typeof f&&(f=f&&"string"===a.type(f)?a.parseJSON(f):{}),b.token_name&&(f[b.token_name]=b.token_value),d.validate="novalidate"!==e.novalidate,d.data=f,d.action=e.action,c.on("click.koowa",function(a){if(a.preventDefault(),d.trigger=c,!c.hasClass("disabled")){var f=c.data("prompt");if(f&&!confirm(f))return;b.setOptions(e),b.trigger("execute",[d])}}),c.data("event-added",!0))})},execute:function(a,b){if(b.action[0]){var c=b.action[0].toUpperCase()+b.action.substr(1),d="_action"+c;"undefined"==typeof b.validate&&(b.validate=!0),this.trigger("before"+c,b)&&(d=this[d]?d:"_actionDefault",this[d].call(this,b),this.trigger("after"+c,b))}return this},on:function(a,b){return this.form.on("koowa:"+a,b)},off:function(a,b){return this.form.off("koowa:"+a,b)},trigger:function(b,c){var d=a.Event("koowa:"+b);return this.form.trigger(d,c),!d.isDefaultPrevented()},checkValidity:function(){var a;this.buttons&&(this.trigger("beforeValidate"),a=this.buttons.filter('[data-novalidate!="novalidate"]'),this.trigger("validate")?a.removeClass("disabled"):a.addClass("disabled"),this.trigger("afterValidate"))}}),Koowa.Controller.Grid=Koowa.Controller.extend({getOptions:function(){return a.extend(this.supr(),{inputs:".-koowa-grid-checkbox, .-koowa-grid-checkall",ajaxify:!1})},initialize:function(a){var b=this;this.supr(a),this.grid=new Koowa.Grid(this.form),this.on("validate",this.validate),this.options.inputs&&this.buttons&&(this.checkValidity(),this.form.find(this.options.inputs).on("change.koowa",function(a,c){c||b.checkValidity()})),this.token_name=this.form.data("token-name"),this.token_value=this.form.data("token-value"),this.setTableHeaders(),this.setTableRows(),this.setFilters(),this.form.find("thead select, tfoot select, .k-pagination select").on("change.koowa",function(){b.grid.uncheckAll(),b.options.ajaxify&&(event.preventDefault(),b.options.transport(b.options.url,b.form.serialize(),"get")),b.form.submit()})},setFilters:function(){var b,c,d,e,f=this.form.find(".k-filter-container"),g=f.find(".k-filter-group--prototype"),h=f.find(".k-filter-container__item"),i=f.find(".js-add-button"),j={},k=[];h.each(function(b,c){var d=a(c);j[d.attr("data-filter")]=d.attr("data-label")}),h=h.detach();var l=function(a){if(n(a))for(var b=k.length-1;b>=0;b--)k[b]===a&&k.splice(b,1)},m=function(a){n(a)||k.push(a)},n=function(b){return-1!==a.inArray(b,k)},o=function(){return k.length<a.map(j,function(){return 0}).length};b=function(b){var c=a("<select />");return a.each(j,function(b,d){n(b)||c.append(a("<option />",{value:b,text:d}))}),c.addClass("select2-filter--no-search js-filter-select"),c.data("selected",b),c.change(function(){var b=c.data("selected"),d=a(this).val(),f=a(this).parents(".k-filter-group").find(".k-filter--container");f.empty().append(h.filter('[data-filter="'+d+'"]')),c.data("selected",d),b&&l(b),e()}),c},e=function(){f.find(".js-filter-select").each(function(b,c){var d=a(c),e=d.val(),f=[];d.find("option").each(function(b,c){var d=a(c),g=d.val();g!==e&&n(g)?d.remove():f.push(g)}),a.each(j,function(b,c){n(b)||b===e||-1!==a.inArray(b,f)||d.append(a("<option />",{value:b,text:c}))})})},c=function(a){var c=g.clone(!0);return c.find(".k-filter--select").append(b(a)),c.find(".k-filter--container").append(h.filter('[data-filter="'+a+'"]')),c.removeClass("k-filter-group--prototype").css("display","").data("filter",a),c.insertBefore(f.find(".js-placeholder")),m(a),e(),p(),c};var p=function(){f.find(".k-filter--text--and").css("display","").eq(1).css("display","none"),i.attr("disabled",o()?!1:!0)};d=function(){var b=null;return a.each(j,function(a){b||n(a)||(b=a)}),b&&(b=c(b)),b},d(),i.click(function(a){a.preventDefault(),d()}),f.on("click",".btn-remove-filter",function(b){b.preventDefault();var c=a(b.target).parents(".k-filter-group"),d=c.data("filter");l(d),e(),p(),c.remove()})},setTableHeaders:function(){this.form.find("thead tr > *").each(function(){var b=a(this),c=b.find("a"),d=b.find(".-koowa-grid-checkall");return c.length?(b.on("click.koowa",function(a){a.target==b[0]&&(c.prop("href")?window.location.href=c.prop("href"):c.trigger("click",a))}),c.hasClass("-koowa-asc")?b.addClass("-koowa-asc"):c.hasClass("-koowa-desc")&&b.addClass("-koowa-desc"),this):(d.length&&b.on("click.koowa",function(a){return a.target!=b[0]?!0:void d.prop("checked",d.is(":checked")?!1:!0).trigger("change")}),void b.addClass("void"))})},setTableRows:function(){var b=this,c=this.form.find("tbody tr .-koowa-grid-checkbox");this.form.find("tbody tr").each(function(){var d=a(this),e=d.find(".-koowa-grid-checkbox");1!=d.data("readonly")&&e.length&&(d.on("click.koowa",function(b){var c=a(b.target);c.is("[type=radio], [type=checkbox], a[href], span.footable-toggle")||e.prop("checked",!e.prop("checked")).trigger("change")}),e.on("change.koowa",function(){var b,c=d.parent();a(this).is("[type=radio]")&&c.find(".selected").removeClass("selected"),a(this).prop("checked")?d.addClass("selected"):d.removeClass("selected"),b=d.hasClass("selected")+d.siblings(".selected").length,b>1?c.addClass("selected-multiple").removeClass("selected-single"):c.removeClass("selected-multiple").addClass("selected-single")}).trigger("change",!0),d.find("[data-action]").each(function(){var d=a(this),f={},g=d.data("data"),h=d.data(),i=d.data("event-type");"object"!=typeof g&&(g=g&&"string"===a.type(g)?a.parseJSON(g):{}),b.token_name&&(g[b.token_name]=b.token_value),i||(i=d.is('[type="radio"],[type="checkbox"],select')?"change":"click"),f.validate="novalidate"!==h.novalidate,f.data=g,f.action=h.action,d.on(i+".koowa",function(){c.prop("checked",""),e.prop("checked","checked"),c.trigger("change",!0),f.trigger=d,b.setOptions(h),b.trigger("execute",[f])})}))})},validate:function(){return Koowa.Grid.getIdQuery()||!1},_actionDelete:function(a){return a.method="delete",this._actionDefault(a)},_actionDefault:function(b){var c,d=Koowa.Grid.getIdQuery(),e=this.options.url.match(/\?/)?"&":"?";return b.validate&&!this.trigger("validate",[b])?!1:(c={method:"post",url:this.options.url+(d?e+d:""),params:a.extend({},{_action:b.action},b.data)},b.method&&(c.params._method=b.method),void new Koowa.Form(c).submit())}}),Koowa.Controller.Form=Koowa.Controller.extend({_actionDefault:function(b){return b.validate&&!this.trigger("validate",[b])?!1:(this.form.append(a("<input/>",{name:"_action",type:"hidden",value:b.action})),this.trigger("submit",[b]),void this.form.submit())}})}(window.kQuery);
//# sourceMappingURL=koowa.js.map